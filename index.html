<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="apple-mobile-web-app-title" content="Ella's Fun Game">
    <meta name="description" content="A fun game for Ella!">
    <meta name="theme-color" content="#1a1a2e">
    <title>Ella's Fun Game!</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Fredoka+One&family=Poppins:wght@400;600&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Poppins', sans-serif;
            background: radial-gradient(circle, #2c2f45, #1a1a2e); /* Muted, clean gradient */
            color: #e6e6fa; /* Light text color */
            margin: 0;
            padding: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            text-align: center;
            overflow: hidden;
            position: relative;
        }

        #app-container {
            width: 100%;
            height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            position: relative;
        }

        .page {
            position: absolute;
            width: 90%;
            max-width: 500px; /* Reduced max-width for cleaner UI */
            padding: 30px;
            background: #2c2f45; /* Dark background for container */
            border-radius: 20px;
            box-shadow: 0 8px 30px rgba(0,0,0,0.5);
            border: none; /* Removed neon border */
            transform: translateX(100vw);
            transition: transform 0.5s cubic-bezier(0.68, -0.55, 0.27, 1.55);
        }

        .page.active {
            transform: translateX(0);
        }

        .page.exit {
            transform: translateX(-100vw);
        }

        h1, h2 {
            font-family: 'Fredoka One', cursive;
            color: #c4def6; /* Soft blue for titles */
            text-shadow: none; /* Removed the glow/blur effect */
        }
        
        p {
            font-size: 1.1em;
            color: #e6e6fa;
        }

        button {
            background: linear-gradient(135deg, #6a85b6, #bac8e0); /* Clean gradient on buttons */
            border: none;
            border-radius: 50px;
            padding: 15px 30px;
            margin: 10px;
            font-size: 1.2em;
            cursor: pointer;
            color: #1a1a2e; /* Dark text on light buttons */
            font-family: 'Poppins', sans-serif;
            font-weight: 600;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            transition: all 0.2s cubic-bezier(0.68, -0.55, 0.27, 1.55);
        }

        button:hover {
            background: linear-gradient(135deg, #bac8e0, #6a85b6);
            transform: scale(1.05); /* Gentle scale up */
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3);
        }
        
        button:active {
            transform: scale(0.95);
        }

        .option-btn {
            display: block;
            width: 80%;
            max-width: 300px;
            margin: 15px auto;
        }
        
        #score-display, #level-display {
            font-size: 1.4em;
            color: #e09f71; /* A warm orange for score to stand out */
            font-weight: 600;
        }

        .hidden {
            display: none;
        }
        
        .confetti {
            position: absolute;
            width: 10px;
            height: 10px;
            background-color: #e09f71; /* Orange */
            animation: confetti-fall 3s linear infinite;
        }

        @keyframes confetti-fall {
            0% { transform: translateY(-100vh) rotate(0deg); opacity: 1; }
            100% { transform: translateY(100vh) rotate(360deg); opacity: 0; }
        }
        
        #confetti-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 10;
        }

        #timer-container {
            width: 100px;
            height: 100px;
            position: relative;
            margin: 20px auto;
        }

        #timer-circle {
            width: 100%;
            height: 100%;
            border-radius: 50%;
            border: 5px solid #c4def6; /* Soft blue circle */
            box-shadow: 0 0 10px #c4def6;
            animation: none; /* Removed pulse animation */
        }
        
        #timer-progress {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-family: 'Fredoka One', cursive;
            font-size: 2em;
            color: #e09f71; /* Orange timer text */
        }

        .thinking-icon {
            width: 80px;
            height: 80px;
            margin: 20px auto;
            border-radius: 50%;
            background: linear-gradient(45deg, #6a85b6, #e09f71); /* Gradient for the icon */
            animation: spin-pulse 2s infinite;
        }

        @keyframes spin-pulse {
            0% { transform: rotate(0deg) scale(1); }
            50% { transform: rotate(180deg) scale(1.1); }
            100% { transform: rotate(360deg) scale(1); }
        }

        /* Custom Modal */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(5px);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 20;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease, visibility 0.3s ease;
        }

        .modal.show {
            opacity: 1;
            visibility: visible;
        }

        .modal-content {
            background: #2c2f45; /* Modal background matches main container */
            padding: 30px;
            border-radius: 20px;
            border: 2px solid #c4def6; /* Soft border */
            max-width: 80%;
            transform: scale(0.8);
            transition: transform 0.3s cubic-bezier(0.68, -0.55, 0.27, 1.55);
        }

        .modal.show .modal-content {
            transform: scale(1);
        }

        #modal-message {
            font-family: 'Fredoka One', cursive;
            font-size: 1.5em;
            color: #c4def6;
        }
        
        #modal-sub-message {
            font-size: 1.1em;
            font-weight: 600;
            margin-top: -10px;
            margin-bottom: 20px;
        }
        
        .modal-buttons {
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        .modal-buttons button {
            width: auto;
            min-width: 150px;
            margin: 5px;
        }
    </style>
</head>
<body>
    <div id="confetti-container"></div>
    <div id="app-container">
        <div id="main-menu" class="page active">
            <h1>Welcome, Ella! üéâ</h1>
            <p>Ready for a super fun game?</p>
            <button onclick="changePage('guessing-game')">Guessing Game</button>
            <button onclick="changePage('lying-game')">Lying Game</button>
        </div>

        <div id="guessing-game" class="page">
            <h2>Guessing Game üßê</h2>
            <div id="game-info">
                <p id="guessing-level">Level: 1</p>
                <p id="guessing-score">Score: 0</p>
            </div>
            <div id="question-area">
                <p id="guessing-question"></p>
                <div id="guessing-options"></div>
            </div>
            <button onclick="nextGuessingQuestion()" id="next-guessing-btn" class="hidden option-btn">Next Question</button>
            <button onclick="changePage('main-menu')">Back to Menu</button>
        </div>

        <div id="lying-game" class="page">
            <h2>Lying Game üòà</h2>
            <div id="game-info">
                <p id="lying-level">Level: 1</p>
                <p id="lying-score">Score: 0</p>
            </div>
            <p id="lying-prompt"></p>
            <div id="timer-container">
                <div id="timer-circle"></div>
                <div id="timer-progress">15</div>
            </div>
            <div id="lying-options"></div>
            <div id="thinking-area" class="hidden">
                <div class="thinking-icon"></div>
                <p>Thinking...</p>
            </div>
            <div id="guess-result"></div>
            <button onclick="nextLyingRound()" id="next-lying-btn" class="hidden option-btn">Next Round</button>
            <button onclick="changePage('main-menu')">Back to Menu</button>
        </div>
    </div>
    
    <div id="custom-modal" class="modal">
        <div class="modal-content">
            <p id="modal-message"></p>
            <p id="modal-sub-message"></p>
            <div id="modal-buttons" class="modal-buttons"></div>
        </div>
    </div>

    <script>
        const appContainer = document.getElementById('app-container');
        const pages = document.querySelectorAll('.page');
        const confettiContainer = document.getElementById('confetti-container');
        const customModal = document.getElementById('custom-modal');
        const modalMessage = document.getElementById('modal-message');
        const modalSubMessage = document.getElementById('modal-sub-message');
        const modalButtons = document.getElementById('modal-buttons');

        let guessingLevel = 1;
        let guessingScore = 0;
        let lyingLevel = 1;
        let lyingScore = 0;
        let timerInterval;
        let audioContext = new (window.AudioContext || window.webkitAudioContext)();
        let tickingOscillator;

        // Sound Functions
        function playSound(frequency, duration, type = 'sine', volume = 0.5) {
            const oscillator = audioContext.createOscillator();
            const gainNode = audioContext.createGain();
            oscillator.connect(gainNode);
            gainNode.connect(audioContext.destination);
            oscillator.frequency.value = frequency;
            oscillator.type = type;
            gainNode.gain.value = volume;
            oscillator.start();
            setTimeout(() => { oscillator.stop(); }, duration * 1000);
        }
        function playCorrect() { playSound(800, 0.1); setTimeout(() => playSound(1200, 0.1), 100); setTimeout(() => playSound(1600, 0.2), 200); }
        function playWrong() { playSound(200, 0.3, 'sawtooth'); }
        function playLevelUp() { for (let i = 0; i < 5; i++) { setTimeout(() => playSound(400 + i * 200, 0.1), i * 100); } }
        function playThinking() { playSound(300, 0.2, 'triangle'); setTimeout(() => playSound(300, 0.2, 'triangle'), 500); setTimeout(() => playSound(300, 0.2, 'triangle'), 1000); }
        function startTicking() {
            tickingOscillator = audioContext.createOscillator();
            const gainNode = audioContext.createGain();
            tickingOscillator.connect(gainNode);
            gainNode.connect(audioContext.destination);
            tickingOscillator.frequency.value = 1000;
            tickingOscillator.type = 'square';
            gainNode.gain.value = 0.1;
            tickingOscillator.start();
            setInterval(() => { gainNode.gain.value = 0.1; setTimeout(() => gainNode.gain.value = 0, 50); }, 1000);
        }
        function stopTicking() { if (tickingOscillator) { tickingOscillator.stop(); } }
        
        // Game Data (same as before)
        const guessingQuestions = [
            { question: "What is the name of the K-pop group with songs like 'Kill This Love'?", options: ["Blackpink", "BTS", "Twice", "EXO"], answer: "Blackpink", level: 1 },
            { question: "In Demon Slayer, what does Tanjiro use to fight demons?", options: ["Sword", "Gun", "Magic Wand", "Book"], answer: "Sword", level: 1 },
            { question: "Finish the song: 'Baby shark, doo doo doo doo doo doo...'", options: ["Baby shark", "Mommy shark", "Daddy shark", "Grandma shark"], answer: "Baby shark", level: 1 },
            { question: "What is a popular trend on TikTok? Dancing to...", options: ["Music", "Books", "Math problems", "Cooking"], answer: "Music", level: 1 },
            { question: "Who sings 'Shake It Off'?", options: ["Taylor Swift", "Ariana Grande", "Billie Eilish", "Katy Perry"], answer: "Taylor Swift", level: 1 },
            { question: "In Frozen, who has ice powers?", options: ["Elsa", "Anna", "Olaf", "Kristoff"], answer: "Elsa", level: 1 },
            { question: "What is a Squishmallow?", options: ["A soft toy", "A game", "A song", "A food"], answer: "A soft toy", level: 1 },
            { question: "Which K-pop idol is known as the 'Golden Maknae' in BTS?", options: ["Jungkook", "V", "Jimin", "Suga"], answer: "Jungkook", level: 2 },
            { question: "In Demon Slayer, who is Tanjiro's sister?", options: ["Nezuko", "Zenitsu", "Inosuke", "Giyu"], answer: "Nezuko", level: 2 },
            { question: "Finish the lyric: 'We don't talk anymore, like we used to...'", options: ["Do", "Go", "See", "Eat"], answer: "Do", level: 2 },
            { question: "What is a current trend? Wearing oversized...?", options: ["Hoodies", "Shoes", "Hats", "Glasses"], answer: "Hoodies", level: 2 },
            { question: "What movie has Elsa and Anna?", options: ["Frozen", "Moana", "Tangled", "Cinderella"], answer: "Frozen", level: 2 },
            { question: "In Moana, what does Moana love?", options: ["The ocean", "The mountains", "The desert", "The city"], answer: "The ocean", level: 2 },
            { question: "What is a popular YouTube channel for kids like Cocomelon good for?", options: ["Nursery rhymes", "Math lessons", "Cooking", "Sports"], answer: "Nursery rhymes", level: 2 },
            { question: "Which Blackpink member released 'Solo'?", options: ["Jennie", "Lisa", "Ros√©", "Jisoo"], answer: "Jennie", level: 3 },
            { question: "In Demon Slayer, what is the name of the demon king?", options: ["Muzan", "Akaza", "Doma", "Kokushibo"], answer: "Muzan", level: 3 },
            { question: "Who sings 'Bad Guy'?", options: ["Billie Eilish", "Olivia Rodrigo", "Doja Cat", "Megan Thee Stallion"], answer: "Billie Eilish", level: 3 },
            { question: "What is a viral challenge? The ... dance.", options: ["Renegade", "Running", "Jumping", "Eating"], answer: "Renegade", level: 3 },
            { question: "Finish: 'I'm a Barbie girl, in a Barbie...'", options: ["World", "House", "Car", "Dream"], answer: "World", level: 3 },
            { question: "In Snow White (2025), who plays Snow White?", options: ["Rachel Zegler", "Gal Gadot", "Emma Watson", "Ariana Grande"], answer: "Rachel Zegler", level: 3 },
            { question: "What trend involves making friendship bracelets?", options: ["Taylor Swift inspired", "Sports", "Cooking", "Reading"], answer: "Taylor Swift inspired", level: 3 },
            { question: "Popular YouTube content for girls: Making...?", options: ["Slime", "Cars", "Trucks", "Tools"], answer: "Slime", level: 3 },
            { question: "Which K-pop group sang 'Dynamite'?", options: ["BTS", "Blackpink", "EXO", "Twice"], answer: "BTS", level: 4 },
            { question: "In Demon Slayer, what breathing style does Zenitsu use?", options: ["Thunder", "Water", "Flame", "Wind"], answer: "Thunder", level: 4 },
            { question: "Who sings 'Drivers License'?", options: ["Olivia Rodrigo", "Taylor Swift", "Ariana Grande", "Billie Eilish"], answer: "Olivia Rodrigo", level: 4 },
            { question: "What trend involves stacking items creatively?", options: ["Squishmallow collecting", "Book stacking", "Food stacking", "Toy stacking"], answer: "Squishmallow collecting", level: 4 },
            { question: "Finish the lyric: 'Shape of you, just as nature...'", options: ["Intended", "Made", "Created", "Built"], answer: "Intended", level: 4 },
            { question: "In Zootopia 2 (2025), who returns as Judy Hopps?", options: ["Ginnifer Goodwin", "Idina Menzel", "Kristen Bell", "Auli'i Cravalho"], answer: "Ginnifer Goodwin", level: 4 },
            { question: "A 2025 K-pop trend: More ... songs.", options: ["EDM/hyper-pop", "Classical", "Jazz", "Country"], answer: "EDM/hyper-pop", level: 4 },
            { question: "Popular YouTube for kids: Blippi teaches about...?", options: ["Colors and vehicles", "Advanced math", "History", "Politics"], answer: "Colors and vehicles", level: 4 },
            { question: "Which Twice member is from Taiwan?", options: ["Tzuyu", "Nayeon", "Jihyo", "Mina"], answer: "Tzuyu", level: 5 },
            { question: "In Demon Slayer, who is the Hashira of Water?", options: ["Giyu Tomioka", "Shinobu Kocho", "Kyojuro Rengoku", "Tengen Uzui"], answer: "Giyu Tomioka", level: 5 },
            { question: "Who sings 'Levitating'?", options: ["Dua Lipa", "Doja Cat", "Cardi B", "Megan Thee Stallion"], answer: "Dua Lipa", level: 5 },
            { question: "What is a popular ASMR trend?", options: ["Whispering", "Shouting", "Running", "Jumping"], answer: "Whispering", level: 5 },
            { question: "Finish: 'Old town road, I'm gonna take my horse...'", options: ["To the old town road", "To the city", "To the farm", "To the store"], answer: "To the old town road", level: 5 },
            { question: "In Lilo & Stitch (2025), what is Stitch?", options: ["An alien", "A dog", "A cat", "A robot"], answer: "An alien", level: 5 },
            { question: "2025 K-pop hit by SEVENTEEN?", options: ["THUNDER", "Dynamite", "Butter", "Pink Venom"], answer: "THUNDER", level: 5 },
            { question: "YouTube channel for educational fun: National Geographic Kids features...?", options: ["Animals and science", "Cartoons only", "Music videos", "Gaming"], answer: "Animals and science", level: 5 },
            { question: "Trend for 2025: DIY ... kits.", options: ["Fashion and building", "Car repair", "Home building", "Farming"], answer: "Fashion and building", level: 5 }
        ];

        const lyingCategories = [
            { level: 1, prompt: "Pick your favorite color, but you can lie!", options: ["Pink", "Blue", "Green", "Yellow"] },
            { level: 1, prompt: "Pick your favorite animal, but you can lie!", options: ["Unicorn", "Dog", "Cat", "Bird"] },
            { level: 1, prompt: "Pick your favorite Disney princess, but you can lie!", options: ["Elsa", "Moana", "Belle", "Ariel"] },
            { level: 2, prompt: "Pick your favorite food, but you can lie!", options: ["Ice Cream", "Pizza", "Candy", "Fruit"] },
            { level: 2, prompt: "Pick your favorite song, but you can lie!", options: ["Baby Shark", "Shake It Off", "Bad Guy", "Dynamite"] },
            { level: 2, prompt: "Pick your favorite YouTube channel, but you can lie!", options: ["Cocomelon", "Blippi", "Peppa Pig", "Ryan's World"] },
            { level: 3, prompt: "Pick your favorite K-pop group, but you can lie!", options: ["Blackpink", "BTS", "Twice", "Stray Kids"] },
            { level: 3, prompt: "Pick your favorite trend, but you can lie!", options: ["TikTok Dance", "ASMR", "Squishmallows", "Friendship Bracelets"] },
            { level: 3, prompt: "Pick your favorite Disney movie, but you can lie!", options: ["Frozen", "Moana", "Snow White", "Zootopia"] },
            { level: 4, prompt: "Pick your favorite movie, but you can lie!", options: ["Frozen", "Moana", "Barbie", "Demon Slayer Movie"] },
            { level: 4, prompt: "Pick your favorite character, but you can lie!", options: ["Elsa", "Tanjiro", "Barbie", "Nezuko"] },
            { level: 4, prompt: "Pick your favorite 2025 trend, but you can lie!", options: ["Slime Making", "Minecraft", "K-pop EDM", "DIY Fashion"] },
            { level: 5, prompt: "Pick your favorite hobby, but you can lie!", options: ["Dancing to K-pop", "Watching Demon Slayer", "Collecting Squishmallows", "Making Slime"] },
            { level: 5, prompt: "Pick your dream pet, but you can lie!", options: ["Dragon", "Pegasus", "Phoenix", "Mermaid"] },
            { level: 5, prompt: "Pick your favorite YouTube content, but you can lie!", options: ["Educational Videos", "Toy Reviews", "Challenges", "Music Covers"] }
        ];

        // Page Navigation
        function changePage(pageId) {
            clearInterval(timerInterval);
            stopTicking();
            pages.forEach(page => {
                if (page.id === pageId) {
                    page.classList.remove('exit');
                    page.classList.add('active');
                } else {
                    page.classList.add('exit');
                    page.classList.remove('active');
                }
            });
            if (pageId === 'guessing-game') { startGuessingGame(); }
            if (pageId === 'lying-game') { startLyingGame(); }
        }

        // Custom Modal Functions
        function showModal(message, subMessage = '', buttons) {
            modalMessage.innerText = message;
            modalSubMessage.innerText = subMessage;
            modalButtons.innerHTML = '';
            buttons.forEach(btnInfo => {
                const btn = document.createElement('button');
                btn.innerText = btnInfo.text;
                btn.onclick = () => {
                    hideModal();
                    if (btnInfo.callback) btnInfo.callback();
                };
                modalButtons.appendChild(btn);
            });
            customModal.classList.add('show');
        }

        function hideModal() {
            customModal.classList.remove('show');
        }

        // Guessing Game Logic
        function startGuessingGame() {
            guessingLevel = 1;
            guessingScore = 0;
            updateGuessingInfo();
            nextGuessingQuestion();
        }
        function updateGuessingInfo() {
            document.getElementById('guessing-level').innerText = `Level: ${guessingLevel}`;
            document.getElementById('guessing-score').innerText = `Score: ${guessingScore}`;
        }
        function nextGuessingQuestion() {
            document.getElementById('next-guessing-btn').classList.add('hidden');
            const levelQuestions = guessingQuestions.filter(q => q.level === guessingLevel);
            if (levelQuestions.length === 0) {
                showModal('üéâ You completed all levels!', '', [{text: 'OK', callback: () => changePage('main-menu')}]);
                return;
            }
            const q = levelQuestions[Math.floor(Math.random() * levelQuestions.length)];
            document.getElementById('guessing-question').innerText = q.question;
            const optionsDiv = document.getElementById('guessing-options');
            optionsDiv.innerHTML = '';
            q.options.forEach(opt => {
                const btn = document.createElement('button');
                btn.innerText = opt;
                btn.classList.add('option-btn');
                btn.onclick = () => checkGuessingAnswer(opt, q.answer);
                optionsDiv.appendChild(btn);
            });
        }
        function checkGuessingAnswer(selected, correct) {
            const isCorrect = (selected === correct);
            if (isCorrect) {
                playCorrect();
                guessingScore += 10 * guessingLevel;
                if (guessingScore >= 50 * guessingLevel) {
                    guessingLevel++;
                    if (guessingLevel > 5) { guessingLevel = 5; } else { playLevelUp(); }
                }
                updateGuessingInfo();
                showConfetti();
                showModal('Yay Ella! Correct!', '', [{text: 'Awesome!', callback: nextGuessingQuestion}]);
            } else {
                playWrong();
                showModal('Oops! Try again next time!', '', [{text: 'OK', callback: nextGuessingQuestion}]);
            }
            document.getElementById('guessing-options').querySelectorAll('button').forEach(btn => btn.disabled = true);
        }

        // Lying Game Logic
        function startLyingGame() {
            lyingLevel = 1;
            lyingScore = 0;
            updateLyingInfo();
            nextLyingRound();
        }
        function updateLyingInfo() {
            document.getElementById('lying-level').innerText = `Level: ${lyingLevel}`;
            document.getElementById('lying-score').innerText = `Score: ${lyingScore}`;
        }
        function nextLyingRound() {
            stopTicking();
            document.getElementById('thinking-area').classList.add('hidden');
            document.getElementById('next-lying-btn').classList.add('hidden');
            document.getElementById('guess-result').innerHTML = '';
            document.getElementById('lying-options').classList.remove('hidden');

            const levelCategories = lyingCategories.filter(c => c.level === lyingLevel);
            if (levelCategories.length === 0) {
                showModal('üéâ You completed all levels!', '', [{text: 'OK', callback: () => changePage('main-menu')}]);
                document.getElementById('lying-prompt').classList.add('hidden');
                document.getElementById('lying-options').classList.add('hidden');
                return;
            }
            const cat = levelCategories[Math.floor(Math.random() * levelCategories.length)];
            document.getElementById('lying-prompt').innerText = cat.prompt;
            const optionsDiv = document.getElementById('lying-options');
            optionsDiv.innerHTML = '';
            cat.options.forEach(opt => {
                const btn = document.createElement('button');
                btn.innerText = opt;
                btn.classList.add('option-btn');
                btn.onclick = () => submitLie(opt);
                optionsDiv.appendChild(btn);
            });
            startTimer(15);
        }
        function startTimer(seconds) {
            let timeLeft = seconds;
            const timerProgress = document.getElementById('timer-progress');
            timerProgress.innerText = timeLeft;
            stopTicking();
            startTicking();
            timerInterval = setInterval(() => {
                timeLeft--;
                timerProgress.innerText = timeLeft;
                if (timeLeft <= 0) {
                    clearInterval(timerInterval);
                    stopTicking();
                    showModal("‚è∞ Time's up, Ella! Let's try again.", '', [{text: 'OK', callback: nextLyingRound}]);
                }
            }, 1000);
        }
        function submitLie(choice) {
            clearInterval(timerInterval);
            stopTicking();
            document.getElementById('lying-options').classList.add('hidden');
            document.getElementById('thinking-area').classList.remove('hidden');
            playThinking();
            setTimeout(() => { guessLie(choice); }, 3000);
        }
        function guessLie(choice) {
            document.getElementById('thinking-area').classList.add('hidden');
            const isLying = Math.random() < (0.3 + (lyingLevel * 0.1)) ? 'lying' : 'telling the truth';
            
            // Show the AI's guess inside the modal
            showModal(
                `I think you're...<br><strong>${isLying}</strong>!`,
                'Was I right? (Did I guess correctly?)',
                [
                    { text: 'Yes!', callback: () => checkLyingAnswer(true) },
                    { text: 'No...', callback: () => checkLyingAnswer(false) }
                ]
            );
        }
        function checkLyingAnswer(wasCorrect) {
            if (wasCorrect) {
                lyingScore += 10 * lyingLevel;
                if (lyingScore >= 30 * lyingLevel) {
                    lyingLevel++;
                    if (lyingLevel > 5) { lyingLevel = 5; } else { playLevelUp(); }
                }
                updateLyingInfo();
                showConfetti();
                showModal("Yay! I guessed right!", '', [{text: 'Cool!', callback: nextLyingRound}]);
            } else {
                showModal("Oh no! I was wrong. Better luck next time for me!", '', [{text: 'OK', callback: nextLyingRound}]);
            }
        }
        
        // Confetti Animation
        function showConfetti() {
            confettiContainer.innerHTML = '';
            for (let i = 0; i < 50; i++) {
                const confetti = document.createElement('div');
                confetti.classList.add('confetti');
                confetti.style.left = `${Math.random() * 100}%`;
                confetti.style.animationDelay = `${Math.random() * 2}s`;
                confetti.style.backgroundColor = `hsl(${Math.random() * 360}, 100%, 75%)`;
                confettiContainer.appendChild(confetti);
            }
            setTimeout(() => { confettiContainer.innerHTML = ''; }, 3000);
        }
    </script>
</body>
</html>
